<main class="main">
    <div id="app-title">
        <h1>Whistle Eats</h1>
        <a routerLink="/restaurant/orders" class="orders-btn">
            Pedidos
        </a>
    </div>
    <div id="restaurant">
        <h2>{{ restaurantName }}</h2>
        <h3>{{ restaurantAddress }}</h3>
        <div class="stars">
            @if(restaurantStars >= 1){
            <span class="star filled">â˜…</span>
            }@else{
            <span class="star">â˜…</span>
            }
            @if(restaurantStars >= 2){
            <span class="star filled">â˜…</span>
            }@else{
            <span class="star">â˜…</span>
            }
            @if(restaurantStars >= 3){
            <span class="star filled">â˜…</span>
            }@else{
            <span class="star">â˜…</span>
            }
            @if(restaurantStars >= 4){
            <span class="star filled">â˜…</span>
            }@else{
            <span class="star">â˜…</span>
            }
            @if(restaurantStars >= 5){
            <span class="star filled">â˜…</span>
            }@else{
            <span class="star">â˜…</span>
            }
        </div>
    </div>
    <div id="products-title">
        <h3>Tus productos</h3>
    </div>
    <div id="products">
        <div id="product-filter">
            <div id="product-filter-search">
                <input #searchInput id="searchProduct-input" type="text" placeholder="Buscar producto"
                    (input)="searchProduct = searchInput.value; productType = 'all'">
            </div>
            <div id="product-filter-types">
                <button (click)="productType = 'all'; searchProduct = ''; searchInput.value = ''"
                    [class.active]="productType == 'all'">Todos</button>
                <button (click)="productType = 'menu'; searchProduct = ''; searchInput.value = ''"
                    [class.active]="productType == 'menu'">MenÃº</button>
                <button (click)="productType = 'comida'; searchProduct = ''; searchInput.value = ''"
                    [class.active]="productType == 'comida'">Comida</button>
                <button (click)="productType = 'bebida'; searchProduct = ''; searchInput.value = ''"
                    [class.active]="productType == 'bebida'">Bebida</button>
                <button (click)="productType = 'complemento'; searchProduct = ''; searchInput.value = ''"
                    [class.active]="productType == 'complemento'">Complemento</button>
            </div>
        </div>
        @for (product of products; track product.id) {
        @if((productType == 'all' || productType == product.type) && (!searchProduct ||
        product.name?.toLowerCase()?.includes(searchProduct.toLowerCase()))){
        <div class="product-item">
            @if (editingProduct?.id === product.id) {
            <form [formGroup]="productForm" (ngSubmit)="onSaveProduct()" class="edit-product-form">
                <div id="product" class="product-item-wrapper">
                    <div id="texts" class="product-content">
                        <input type="text" formControlName="name" class="product-title edit-input-title"
                            placeholder="Nombre">

                        <div class="edit-price-wrapper">
                            <input type="number" formControlName="price" class="product-price edit-input-price"
                                placeholder="Precio" step="0.01">
                            <span class="product-price">â‚¬</span>
                        </div>

                        <textarea formControlName="description" class="product-description edit-input-description"
                            placeholder="DescripciÃ³n"></textarea>

                        <select formControlName="type" class="edit-select-type">
                            <option value="menu">MenÃº</option>
                            <option value="comida">Comida</option>
                            <option value="bebida">Bebida</option>
                            <option value="complemento">Complemento</option>
                        </select>
                        <input #editFileInput type="file" (change)="onFileSelected($event)" accept="image/*"
                            class="hidden-file-input">
                    </div>
                    <div class="product-image-wrapper edit-image-container">
                        <img [src]="previewUrl || productForm.get('imageUrl')?.value || product.imageurl || 'images/600x400.jpg'"
                            class="edit-image-preview clickable-image" (click)="editFileInput.click()"
                            title="Click para cambiar imagen">

                        <div class="edit-actions">
                            <button type="submit" [disabled]="productForm.invalid" class="action-btn btn-success">
                                <span class="action-icon">âœ“</span>
                            </button>
                            <button type="button" (click)="cancelEdit()" class="action-btn btn-secondary">
                                <span class="action-icon">âœ•</span>
                            </button>
                            <button type="button" (click)="onDeleteProduct(product.id)" class="action-btn btn-danger">
                                <span class="action-icon">ðŸ—‘</span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
            } @else {
            <div id="product">
                <div id="texts">
                    <h4 class="product-title">{{ product.name }}</h4>
                    <p class="product-price">{{ product.price }}â‚¬</p>
                    <p class="product-description">{{ product.description }}</p>
                </div>
                <div class="product-image-wrapper">
                    <a class="image"><img [src]="product.imageurl || 'images/600x400.jpg'" [alt]="product.name"></a>
                    <button class="edit" (click)="startEdit(product)"><img src="images/edit.png" alt="Editar"></button>
                </div>
            </div>
            }
            <hr>
        </div>
        }
        } @empty {
        <p class="empty-products">No hay productos disponibles.</p>
        }
    </div>

    @if (showAddForm) {
    <div class="add-product-form add-form-container">
        <h4>AÃ±adir nuevo producto</h4>
        <form [formGroup]="productForm" (ngSubmit)="onSaveProduct()">
            <div class="form-field-group">
                <input type="text" formControlName="name" placeholder="Nombre del producto" class="add-input">
            </div>
            <div class="form-field-group">
                <textarea formControlName="description" placeholder="DescripciÃ³n" class="add-input"></textarea>
            </div>
            <div class="form-field-group">
                <input type="number" formControlName="price" placeholder="Precio" step="0.01" class="add-input">
            </div>
            <div class="form-field-group image-upload-group">
                <input #addFileInput type="file" (change)="onFileSelected($event)" accept="image/*"
                    class="hidden-file-input">

                <div class="add-image-preview-container">
                    <img [src]="previewUrl || 'images/600x400.jpg'" class="add-image-preview clickable-image"
                        (click)="addFileInput.click()" title="Click para subir imagen">
                </div>
            </div>
            <div class="form-field-group">
                <select formControlName="type" class="add-input">
                    <option value="menu">MenÃº</option>
                    <option value="comida">Comida</option>
                    <option value="bebida">Bebida</option>
                    <option value="complemento">Complemento</option>
                </select>
            </div>
            <div class="add-form-actions">
                <button type="submit" [disabled]="productForm.invalid" class="add-btn add-btn-success">
                    Crear Producto
                </button>
                <button type="button" (click)="toggleAddForm()" class="add-btn add-btn-secondary">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
    }

    <div class="add">
        <button class="add-product" (click)="toggleAddForm()">+</button>
    </div>

</main>