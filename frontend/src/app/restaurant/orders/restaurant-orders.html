<main class="main">
    <div class="header">
        <div class="header-left">
            <a routerLink="/restaurant" class="back-btn">â† Volver</a>
            <h1>Pedidos Recibidos</h1>
        </div>
        <div class="header-actions">
            <button class="push-btn" (click)="subscribeToPush()">ğŸ”” Activar Notif.</button>
            <button class="push-btn" style="background-color: #2196F3;" (click)="sendTestNotification()">ğŸ§ª Test
                Push</button>
            <button class="refresh-btn" (click)="refreshOrders()" [disabled]="loading">Actualizar</button>
        </div>
    </div>

    <div class="orders-container">
        @if (loading) {
        <div class="loading">Cargando pedidos...</div>
        } @else {
        @for (order of orders; track order.ID) {
        <div class="order-card" [class]="order.status">
            <div class="order-header">
                <span class="order-id-badge">Pedido #{{ order.ID.slice(0, 8) }}</span>
                <span class="order-status" [class]="order.status">{{ formatStatus(order.status) }}</span>
            </div>
            <p class="order-details">
                {{ order.created_at | date:'short' }}
            </p>

            <div class="order-items">
                <ul>
                    @for (item of order.items; track item.ID) {
                    <li>{{ item.quantity }}x {{ item.product.name }}</li>
                    }
                </ul>
            </div>

            <div class="order-footer">
                @if (order.status === 'pendiente_de_aceptacion_restaurante') {
                <div class="action-buttons">
                    <button class="accept-btn" (click)="acceptOrder(order)">Aceptar</button>
                    <button class="reject-btn" (click)="rejectOrder(order)">Rechazar</button>
                </div>
                }
                @if (order.status === 'pendiente_de_aceptacion_repartidor' || order.status === 'en_camino') {
                <div class="verification-section">
                    <input type="text" [(ngModel)]="order.verificationCode" placeholder="CÃ³digo" maxlength="4"
                        class="code-input">
                    <button class="verify-btn" (click)="verifyOrder(order)">Verificar</button>
                </div>
                }
                <strong class="total">Total: {{ order.totalamount | number:'1.2-2' }}â‚¬</strong>
            </div>
        </div>
        } @empty {
        <div class="no-orders">
            <p>No hay pedidos registrados.</p>
        </div>
        }
        }
    </div>
</main>